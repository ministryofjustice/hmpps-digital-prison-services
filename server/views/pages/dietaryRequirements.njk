{% extends "../partials/layout.njk" %}
{% from "../macros/hmppsPagedListHeader.njk" import hmppsPagedListHeader %}
{% from "../macros/hmppsPagedListFooter.njk" import hmppsPagedListFooter %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% set pageTitle = "Dietary requirements" %}
{% set mainClasses = "govuk-body govuk-main-wrapper--auto-spacing" %}

{% set breadCrumbs = [
    {
        text: 'Digital Prison Services',
        href:  '/'
    }
] %}

{% macro dietaryRequirementsHtml(dietaryRequirements) %}
  {% if(dietaryRequirements.medical.length > 0) %}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-0">Medical</p>
    <p class="govuk-body" data-qa="medical-requirements">    
      {% for need in dietaryRequirements.medical %}
        {{ need }}<br />
      {% endfor %}
    </p>
  {% endif %}

  {% if(dietaryRequirements.foodAllergies.length > 0) %}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-0">Food allergies</p>
    <p class="govuk-body" data-qa="food-allergies">    
      {% for need in dietaryRequirements.foodAllergies %}
        {{ need }}<br />
      {% endfor %}
    </p>
  {% endif %}

  {% if(dietaryRequirements.personal.length > 0) %}
    <p class="govuk-body govuk-!-font-weight-bold govuk-!-margin-bottom-0">Personal</p>
    <p class="govuk-body" data-qa="personal-requirements">
    {% for need in dietaryRequirements.personal %}
      {{ need }}<br />
    {% endfor %}
    </p>
  {% endif %}
{% endmacro %}

{% set rows = [] %}
{% for row in content %}
  {% set rows = (rows.push([
    { html: row.name + "<br />" + row.prisonerNumber },
    { text: row.location },
    { html: dietaryRequirementsHtml(row.dietaryRequirements) }
  ]), rows) %}
{% endfor %}

{% block content %}
  <div class="govuk-width-container">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-l">People with dietary requirements in {{ "Prison Name" }}</h1>
        <p class="govuk-body">This information is from the diet and food allergies secion on the DPS prisoner profile.</p>
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full govuk-!-text-align-right">
        <p class="govuk-body">
          <a class="hmpps-print-link" href="/dietary-requirements/{{ locationId }}/print-all">Print all</a>  
        </p>
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        {{ hmppsPagedListHeader(listMetadata) }}
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        {{ govukTable({
          head: [
            {
              html: '<a href="' + sorting.nameAndNumber.url + '">Name and prison number</a>',
              attributes: {
                "data-qa": "name-and-number-header",
                "aria-sort": sorting.nameAndNumber.direction
              }
            },
            {
              html: '<a href="' + sorting.location.url + '">Location</a>',
              attributes: {
                "data-qa": "location-header",
                "aria-sort": sorting.location.direction
              }
            },
            {
              text: 'Dietary requirements'
            }
          ],
          rows: rows
        }) }}
      </div>
    </div>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        {{ hmppsPagedListFooter(listMetadata) }}
      </div>
    </div>
  </div>
{% endblock %}

